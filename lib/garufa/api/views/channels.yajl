channels = {}

stats.each do |data|

  channel = data[:name].to_s

  if channel.start_with? filter[:prefix].to_s
    channels[channel] = {}

    if filter[:info].include? 'user_count'
      channels[channel] = { user_count: data[:presence][:ids].count }
    end
  end
end

json[:channels] = channels
